/**
 * Magitek Resonance 2.0 Chassis Styles
 * Three-Layer Architecture System
 * 
 * Strict Style Isolation: CSS Modules only
 * Design tokens live in :root (index.css). Magitek theme tokens are injected
 * globally here to enable theme-switchable skinning without touching component CSS.
 */

.chassis {
  position: relative;
  width: 100%;
  min-height: var(--magitek-viewport-h, 100vh);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  /* Box-model standardization: never let padding inflate width */
  box-sizing: border-box;
  /* Geometry SSOT: sourced from ChassisGeometry.module.css (global custom props) */
  --hud-width: var(--magitek-hud-width);
  --hud-height: var(--magitek-hud-height);
  --hud-seal-point: var(--magitek-hud-seal-point);
  --hud-visual-overlap: var(--magitek-hud-visual-overlap);
  --hud-deep-mount-top: var(--magitek-hud-deep-mount-top);
  /* Mask tuning (anti "cut-corner" glow clipping) */
  --hud-mask-feather: calc(var(--magitek-hud-mask-feather) * 1.55);
  --hud-mask-shift: -14px;

  --pedestal-width: var(--magitek-pedestal-width);
  --pedestal-height: var(--magitek-pedestal-height);
  --pedestal-mask-feather: var(--magitek-pedestal-mask-feather);

  --chassis-bottom-metal-height: var(--magitek-chassis-bottom-metal-height);
  --chassis-bottom-height: var(--magitek-chassis-bottom-height);

  --magitek-hud-w: var(--magitek-hud-width);
  --magitek-hud-h: var(--magitek-hud-height);
  --magitek-pedestal-w: var(--magitek-pedestal-width);
  --magitek-pedestal-h: var(--magitek-pedestal-height);

  --rail-width: var(--magitek-rail-width);
  --magitek-scroll-pad-x: var(--magitek-rail-width);
}

/* Ensure border-box for every descendant (incl. spacers/pseudos). */
.chassis *,
.chassis *::before,
.chassis *::after {
  box-sizing: border-box;
}

/* ============================================
   Background Layer - Ambient effects
   ============================================ */
.backgroundLayer {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1000;
  pointer-events: none;
  /* Background decorative elements can be added here */
}

.masterBgImg {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: center;
  opacity: 1;
  pointer-events: none;
  user-select: none;
}

/* ============================================
   ScrollContent Layer - Main scrollable content
   ============================================ */
.scrollContentLayer {
  /* Fixed Masked Wrapper (static lens) */
  position: fixed;
  inset: 0;
  z-index: 2000; /* #layer-scroll-content */
  width: 100%;
  height: var(--magitek-viewport-h, 100vh);
  overflow: hidden; /* scrolling happens in child container */
  pointer-events: auto;
  background: transparent;

  /* =========================================
     Mandatory Void Masking (V6)
     - Hide content under HUD/Pedestal plates even through transparency.
     - Bound to --hud-height and --pedestal-height.
     ========================================= */
  /* Feathered holographic fade (matches 80/10/10 zones)
     Defaults (when --hud-height/--pedestal-height are 12vh):
     - 0–8vh: transparent
     - 8–15vh: fade in
     - 15–85vh: solid
     - 85–92vh: fade out
     - 92–100vh: transparent

     The offsets (4vh / 3vh / 4vh) keep behavior stable if vars change.
  */
  /* IMPORTANT: use WHITE (not black) for broad mask compatibility.
     Some engines treat mask as luminance; black=0 (hidden), white=1 (visible).
  */
  -webkit-mask-image: linear-gradient(
    to bottom,
    transparent 0,
    /* Fade-in across the overlap zone (green line -> seal point) */
    transparent calc(var(--hud-deep-mount-top) - var(--hud-mask-feather) + var(--hud-mask-shift, 0px)),
    rgba(255, 255, 255, 1) calc(var(--hud-seal-point) + (var(--hud-mask-feather) * 0.35) + var(--hud-mask-shift, 0px)),
    /* Bottom hard cutoff: fully occlude at pedestal metal edge */
    rgba(255, 255, 255, 1) calc(var(--magitek-viewport-h, 100vh) - var(--chassis-bottom-metal-height) - var(--pedestal-mask-feather) + 50px),
    rgba(255, 255, 255, 0) calc(var(--magitek-viewport-h, 100vh) - var(--chassis-bottom-metal-height) + 50px),
    rgba(255, 255, 255, 0) 100%
  );
  mask-image: linear-gradient(
    to bottom,
    transparent 0,
    /* Fade-in across the overlap zone (green line -> seal point) */
    transparent calc(var(--hud-deep-mount-top) - var(--hud-mask-feather) + var(--hud-mask-shift, 0px)),
    rgba(255, 255, 255, 1) calc(var(--hud-seal-point) + (var(--hud-mask-feather) * 0.35) + var(--hud-mask-shift, 0px)),
    /* Bottom hard cutoff: fully occlude at pedestal metal edge */
    rgba(255, 255, 255, 1) calc(var(--magitek-viewport-h, 100vh) - var(--chassis-bottom-metal-height) - var(--pedestal-mask-feather) + 50px),
    rgba(255, 255, 255, 0) calc(var(--magitek-viewport-h, 100vh) - var(--chassis-bottom-metal-height) + 50px),
    rgba(255, 255, 255, 0) 100%
  );
  -webkit-mask-repeat: no-repeat;
  mask-repeat: no-repeat;
  -webkit-mask-size: 100% 100%;
  mask-size: 100% 100%;
  -webkit-mask-mode: alpha;
  mask-mode: alpha;

  /* Limb Restoration test: disable the mask entirely */
  -webkit-mask-image: none;
  mask-image: none;
}

.scrollInnerView {
  position: relative;
  width: 100%;
  height: 100%;
  overflow-y: auto; /* Scroll Target */
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  pointer-events: auto;
  display: flex;
  flex-direction: column;
}

.scrollContent {
  width: 100%;
  min-height: 100%;
  /* 80/10/10 push: keep content reachable in the visible zone */
  /* Content-only avoidance: keep main content below HUD solid area (incl. safe-area) */
  padding-top: calc(var(--hud-seal-point) + 2vh);
  padding-bottom: 2rem;
  background: transparent;

  /* “Kiss the rails” on any screen */
  padding-left: var(--rail-width);
  padding-right: var(--rail-width);
}

.pageFooterSpacer {
  height: var(--chassis-bottom-height);
  margin-top: 1.5rem; /* 給予視覺呼吸空間 */
  flex-shrink: 0;
}

/* Neon Scalpel (Diagnostic) - only when ?debugDock=1 */
.debugDocking { --_debugDocking: 1; }
.ghostFrameTest { --_ghostFrameTest: 1; }

.debugDocking .exoskeleton {
  outline: 2px solid rgba(0, 255, 255, 0.9);
  outline-offset: -2px;
}

.debugDocking .pageFooterSpacer {
  outline: 2px dashed rgba(0, 255, 0, 0.9);
  outline-offset: -2px;
  background: rgba(0, 255, 0, 0.07);
}

/* ============================================
   Foreground Layer - Fixed UI, modals, overlays
   ============================================ */
.foregroundLayer {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  /* Foreground navigation/HUD layer */
  z-index: 3000; /* Fixed frame surface */
  pointer-events: none;
}

.foregroundLayer.overlayActive {
  pointer-events: auto;
}

/* Overlay backdrop */
.overlayBackdrop {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  z-index: 1001;
}

/* Modal container */
.modalContainer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1002;
  pointer-events: none;
}

/* Ensure modals are clickable */
.modalContainer > * {
  pointer-events: auto;
}

/* ============================================
   HUD Mask Layer (Top Layer: Frame + Pedestal)
   ============================================ */
.hudMaskLayer {
  position: fixed;
  inset: 0;
  z-index: 3000; /* #layer-hud-mask */
  pointer-events: none;
  height: auto; /* height liberation: let children self-size */
  padding: 0; /* required: zero padding/margin for fixed HUD surface */
  margin: 0;
}

/* ============================================
  Exoskeleton Dock (V6.2)
  - Physically docks below HUD bottom edge (no safe-area double counting)
  ============================================ */
.exoskeleton {
  position: absolute;
  /* Pull up by the overlap amount */
  top: calc(var(--hud-seal-point) - var(--hud-visual-overlap));
  left: 0;
  width: 100%;
  /* Compensate height to keep it filling the screen */
  height: calc(100% - (var(--hud-seal-point) - var(--hud-visual-overlap)));
  /* NOTE: No padding here — structure must "grow" into overlap zone. */
  /* 向上微調產生重疊，避免亞像素漏光 */
  margin-top: var(--magitek-overlap-neg);
  pointer-events: none;
  z-index: 35;
}

.exoskeleton > * {
  pointer-events: auto;
}

/* ============================================
   Responsive adjustments
   ============================================ */
@media (max-width: 768px) {
  /* Mobile-specific scroll behavior */
  .scrollInnerView {
    -webkit-overflow-scrolling: touch;
  }
  
  .overlayBackdrop {
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
  }
}
